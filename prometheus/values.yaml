prometheus:
  ########################################
  # PROMETHEUS SERVER
  ########################################
  server:
    enabled: true
    replicaCount: 1
    retention: "15d"

    extraArgs:
      web.enable-remote-write-receiver: ""

    service:
      type: NodePort
      port: 9090
      nodePort: 30090

    persistentVolume:
      enabled: true
      size: 10Gi
      storageClass: local-path

  ########################################
  # ALERTMANAGER
  ########################################
  alertmanager:
    enabled: true
    service:
      type: NodePort
      nodePort: 30903

  ########################################
  # OTHER COMPONENTS
  ########################################
  pushgateway:
    enabled: false

  kubeStateMetrics:
    enabled: true

  nodeExporter:
    enabled: true

  ########################################
  # BLACKBOX EXPORTER (HELM-MANAGED)
  ########################################
  prometheus-blackbox-exporter:
    enabled: true

    image:
      repository: prom/blackbox-exporter
      tag: v0.25.0

    service:
      type: ClusterIP
      port: 9115

    config:
      modules:
        tcp_connect:
          prober: tcp
          timeout: 5s

        http_2xx:
          prober: http
          timeout: 5s
          http:
            valid_http_versions: ["HTTP/1.1", "HTTP/2"]
            valid_status_codes: []

  ########################################
  # PROMETHEUS CONFIG
  ########################################
  serverFiles:
    prometheus.yml:
      global:
        scrape_interval: 15s
        evaluation_interval: 15s

      scrape_configs:
        ####################################
        # GRAFANA AGENT
        ####################################
        - job_name: "grafana-agent"
          static_configs:
            - targets:
                - grafana-agent.monitoring.svc.cluster.local:12345

        ####################################
        # BLACKBOX TCP CHECKS
        ####################################
        - job_name: "blackbox-tcp"
          metrics_path: /probe
          params:
            module: [tcp_connect]
          static_configs:
            - targets:
                - smtp.gmail.com:587
                - google.com:443
                - kubernetes.default.svc.cluster.local:443
                - postgres.default.svc.cluster.local:5432
          relabel_configs:
            - source_labels: [__address__]
              target_label: __param_target
            - source_labels: [__param_target]
              target_label: instance
            - target_label: __address__
              replacement: prometheus-blackbox-exporter.default.svc.cluster.local:9115

        ####################################
        # BLACKBOX HTTP CHECKS
        ####################################
        - job_name: "blackbox-http"
          metrics_path: /probe
          params:
            module: [http_2xx]
          static_configs:
            - targets:
                - https://google.com
                - https://grafana.com
          relabel_configs:
            - source_labels: [__address__]
              target_label: __param_target
            - source_labels: [__param_target]
              target_label: instance
            - target_label: __address__
              replacement: prometheus-blackbox-exporter.monitoring.svc.cluster.local:9115

    ########################################
    # TEST ALERT RULE
    ########################################
    alerting_rules.yml:
      groups:
        - name: test-alerts
          rules:
            - alert: AlertmanagerTest
              expr: vector(1)
              for: 10s
              labels:
                severity: warning
              annotations:
                summary: "Test alert from Prometheus"
                description: "This is a test alert to verify Alertmanager connectivity"


grafana:
  replicas: 1

  image:
    repository: grafana/grafana
    tag: 11.0.0

  service:
    type: NodePort
    port: 3000

  nodeSelector:
    workload: grafana

  tolerations:
    - key: "node-role.kubernetes.io/control-plane"
      operator: "Exists"
      effect: "NoSchedule"

  resources:
    requests:
      cpu: 200m
      memory: 512Mi
    limits:
      cpu: 500m
      memory: 1Gi

  persistence:
    enabled: true
    size: 10Gi

  # Required for PVC permissions (Grafana 7+)
  securityContext:
    runAsUser: 472
    runAsGroup: 472
    fsGroup: 472

  initChownData:
    enabled: true

  # Admin credentials (already correct)
  admin:
    existingSecret: grafana-admin-secret
    userKey: admin-user
    passwordKey: admin-password

  # =========================
  # SMTP CONFIG (ALERTING)
  # =========================
  grafana.ini:
    server:
      root_url: "%(protocol)s://%(domain)s:%(http_port)s/"

    security:
      allow_embedding: true

    smtp:
      enabled: true
      host: smtp.gmail.com:587
      from_address: pradyumnadash287@gmail.com
      from_name: Grafana Alerts
      skip_verify: true
      startTLS_policy: OpportunisticStartTLS
      user: ${GF_SMTP_USER}
      password: ${GF_SMTP_PASSWORD}

  # Inject SMTP creds from Kubernetes Secret
  env:
    GF_SMTP_USER:
      valueFrom:
        secretKeyRef:
          name: grafana-smtp-secret
          key: smtp-user

    GF_SMTP_PASSWORD:
      valueFrom:
        secretKeyRef:
          name: grafana-smtp-secret
          key: smtp-password
